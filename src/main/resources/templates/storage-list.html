    <!DOCTYPE html>
    <html lang="vi" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Danh s√°ch kho</title>
        <link rel="stylesheet" th:href="@{/css/storage-list.css}">
        <!-- Th√™m v√†o ph·∫ßn <head> ho·∫∑c tr∆∞·ªõc script cu·ªëi trang -->
        <script src="https://unpkg.com/lucide@latest"></script>

    </head>

    <body>
    <div class="page-wrapper">
        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="navbar-content">
                <div class="navbar-brand">
                    <a href="/home-page">
                        <img src="https://res.cloudinary.com/dpkxslork/image/upload/v1750066568/logoooooooo_j1ynjc.png"
                             alt="QVL Storage Logo" class="navbar-logo">
                    </a>
                </div>
                <ul class="navbar-nav">
                    <li><a href="/home-page">Trang ch·ªß</a></li>
                    <li><a href="/SWP/storages" class="active">Danh s√°ch</a></li>

                </ul>
                <button class="cart-icon" onclick="goToWishlist()" title="Xem wishlist">
                    üõí
                    <span class="cart-count" id="cartCount">0</span>
                </button>
            </div>
        </nav>

        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-content">
                <h1>T√¨m ki·∫øm kho l∆∞u tr·ªØ</h1>
                <p>H·ªá th·ªëng cho thu√™ kho h√†ng chuy√™n nghi·ªáp v·ªõi h∆°n 1000+ kho tr√™n to√†n qu·ªëc</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container">
            <!-- Search Section -->
            <div class="search-section">
                <div class="search-card">
                    <form method="get" th:action="@{/SWP/storages}" class="search-form">
                        <div class="search-grid">
                            <div class="form-group">
                                <label for="storageName">T√™n kho</label>
                                <div class="input-with-icon">
                                    <i data-lucide="search"></i>
                                    <input type="text"
                                           id="storageName"
                                           name="storageName"
                                           th:value="${param.storageName}"
                                           placeholder="T√¨m theo t√™n kho..."
                                           class="form-input">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="city">Th√†nh ph·ªë</label>
                                <div class="select-wrapper">
                                    <select name="city" id="city" class="form-select">
                                        <option value="">T·∫•t c·∫£ th√†nh ph·ªë</option>
                                        <option th:each="city : ${cities}"
                                                th:value="${city}"
                                                th:text="${city}"
                                                th:selected="${param.city != null and param.city.equals(city)}">
                                        </option>
                                    </select>
                                    <i data-lucide="chevron-down"></i>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="status">Tr·∫°ng th√°i</label>
                                <div class="select-wrapper">
                                    <select name="status" id="status" class="form-select">
                                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                                        <option value="true" th:selected="${param.status != null and param.status.equals('true')}">C√≤n tr·ªëng</option>
                                        <option value="false" th:selected="${param.status != null and param.status.equals('false')}">ƒêang thu√™</option>
                                    </select>
                                    <i data-lucide="chevron-down"></i>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i data-lucide="search"></i>
                                    T√¨m ki·∫øm
                                </button>
                                <a th:href="@{/SWP/storages}" class="btn btn-secondary">
                                    <i data-lucide="filter-x"></i>
                                    X√≥a b·ªô l·ªçc
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section">
                <div class="results-header">
                    <div class="results-info">
                        <h2>T√¨m th·∫•y <span class="count" th:text="${storages.size()}">0</span> kho</h2>
                    </div>
                </div>

                <!-- Storage Grid -->
                <div class="storage-grid" id="storageGrid">
                    <div class="storage-card" th:each="storage : ${storages}">
                        <div class="card-header">
                            <h3 class="storage-name" th:text="${storage.storagename}">T√™n kho</h3>
                            <div th:class="${storage.status} ? 'status-badge status-available' : 'status-badge status-rented'"
                                 th:text="${storage.status} ? 'C√≤n tr·ªëng' : 'ƒêang thu√™'">
                                Tr·∫°ng th√°i
                            </div>
                        </div>

                        <div class="card-content">
                            <div class="storage-info">
                                <div class="info-item">
                                    <i data-lucide="map-pin"></i>
                                    <span th:text="${storage.address + ', ' + storage.state + ', ' + storage.city}">ƒê·ªãa ch·ªâ</span>
                                </div>
                            </div>
                        </div>

                        <div class="card-footer">
                            <a th:href="@{'/SWP/storages/' + ${storage.storageid}}" class="btn btn-primary btn-full">
                                <i data-lucide="eye"></i>
                                Xem chi ti·∫øt
                            </a>
                            <button class="btn-wishlist"
                                    th:attr="data-storage-id=${storage.storageid}"
                                    onclick="toggleWishlist(this)">
                                + Th√™m v√†o gi·ªè
                            </button>
                        </div>
                    </div>
                </div>

                <!-- No Results Message -->
                <div th:if="${storages.isEmpty()}" class="no-results">
                    <div class="no-results-icon">
                        <i data-lucide="search-x"></i>
                    </div>
                    <h3>Kh√¥ng t√¨m th·∫•y kho n√†o</h3>
                    <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc t√¨m ki·∫øm ƒë·ªÉ xem th√™m k·∫øt qu·∫£</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-brand">
                        <div class="brand-header">
                            <img src="https://res.cloudinary.com/dpkxslork/image/upload/v1750066568/logoooooooo_j1ynjc.png"
                                 alt="QVL Storage Logo" class="footer-logo">
                            <h2 class="brand-name">QVL Storage</h2>
                        </div>
                        <p class="brand-description">
                            H·ªá th·ªëng cho thu√™ kho h√†ng chuy√™n nghi·ªáp tr√™n to√†n qu·ªëc. Ch√∫ng t√¥i cung c·∫•p gi·∫£i ph√°p l∆∞u tr·ªØ an to√†n, ti·ªán l·ª£i v√† hi·ªáu qu·∫£ cho m·ªçi nhu c·∫ßu kinh doanh.
                        </p>
                    </div>

                    <div class="footer-column">
                        <h3>V·ªÅ ch√∫ng t√¥i</h3>
                        <ul class="footer-links">
                            <li><a href="#">D·ªãch v·ª•</a></li>
                            <li><a href="#">Tin t·ª©c</a></li>
                            <li><a href="#">Li√™n h·ªá</a></li>
                        </ul>
                    </div>

                    <div class="footer-column">
                        <h3>H·ªó tr·ª£</h3>
                        <ul class="footer-links">
                            <li><a href="#">Trung t√¢m tr·ª£ gi√∫p</a></li>
                            <li><a href="#">Chat tr·ª±c tuy·∫øn</a></li>
                            <li><a href="#">Hotline 24/7</a></li>
                        </ul>
                    </div>

                    <div class="footer-column">
                        <h3>S·∫£n ph·∫©m</h3>
                        <ul class="footer-links">
                            <li><a href="#">Kho nh·ªè</a></li>
                            <li><a href="#">Kho v·ª´a</a></li>
                            <li><a href="#">Kho l·ªõn</a></li>
                        </ul>
                    </div>
                </div>

                <div class="footer-divider"></div>

                <div class="footer-bottom">
                    <p class="copyright">B·∫£n quy·ªÅn ¬©2024. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u. ‚Äî QVL Storage System</p>
                    <ul class="footer-bottom-links">
                        <li><a href="#">ƒêi·ªÅu kho·∫£n & ƒêi·ªÅu ki·ªán</a></li>
                        <li><a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
                    </ul>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // View toggle functionality
        const viewButtons = document.querySelectorAll('.view-btn');
        const storageGrid = document.getElementById('storageGrid');

        viewButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                viewButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const view = btn.dataset.view;
                storageGrid.className = view === 'list' ? 'storage-list' : 'storage-grid';
            });
        });

        // Add smooth scroll behavior
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
    <div id="toast" class="toast"></div>

    <script>
        // Wishlist management
        let wishlistItems = new Set();

        // Load wishlist from server on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadWishlist();
        });

        async function loadWishlist() {
            try {
                const response = await fetch('/api/wishlist/my');
                if (response.ok) {
                    const wishlist = await response.json();
                    wishlistItems.clear();
                    wishlist.forEach(item => {
                        if (item.storage && item.storage.storageid) {
                            wishlistItems.add(item.storage.storageid);
                        }
                    });
                    updateWishlistUI();
                    updateCartCount();
                } else if (response.status === 401) {
                    // User not logged in, that's ok
                    console.log('User not logged in');
                    updateCartCount(); // Still update UI even if not logged in
                }
            } catch (error) {
                console.log('Error loading wishlist:', error);
                updateCartCount(); // Still update UI on error
            }
        }

        async function toggleWishlist(button) {
            const storageId = parseInt(button.getAttribute('data-storage-id'));
            const isInWishlist = wishlistItems.has(storageId);

            try {
                const url = isInWishlist ? '/api/wishlist/remove' : '/api/wishlist/add';
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ storageId })
                });

                if (response.ok) {
                    if (isInWishlist) {
                        wishlistItems.delete(storageId);
                        showToast('ƒê√£ x√≥a kh·ªèi wishlist!', 'success');
                    } else {
                        wishlistItems.add(storageId);
                        showToast('ƒê√£ th√™m v√†o wishlist!', 'success');
                    }
                    updateWishlistUI();
                    updateCartCount();
                } else {
                    const errorText = await response.text();
                    showToast(errorText || 'C√≥ l·ªói x·∫£y ra!', 'error');
                }
            } catch (error) {
                showToast('C√≥ l·ªói x·∫£y ra!', 'error');
                console.error('Error:', error);
                button.textContent = originalText;
            } finally {
                button.disabled = false;
            }
        }

        function updateWishlistUI() {
            document.querySelectorAll('.btn-wishlist').forEach(button => {
                const storageId = parseInt(button.getAttribute('data-storage-id'));
                if (wishlistItems.has(storageId)) {
                    button.classList.add('in-wishlist');
                    button.textContent = '‚úì ƒê√£ th√™m';
                } else {
                    button.classList.remove('in-wishlist');
                    button.textContent = '+ Th√™m v√†o gi·ªè';
                }
            });
        }

        function updateCartCount() {
            const count = wishlistItems.size;
            const cartCountElement = document.getElementById('cartCount');

            if (cartCountElement) {
                cartCountElement.textContent = count;

                // Hide count if 0
                if (count === 0) {
                    cartCountElement.style.display = 'none';
                } else {
                    cartCountElement.style.display = 'flex';
                }
            }
        }

        // FIX: Add error handling for wishlist navigation
        function goToWishlist() {
            try {
                window.location.href = '/SWP/wishlist';
            } catch (error) {
                console.error('Error navigating to wishlist:', error);
                showToast('C√≥ l·ªói khi chuy·ªÉn trang!', 'error');
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.textContent = message;
                toast.className = 'toast ' + type;
                toast.classList.add('show');

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }
    </script>

    </body>
    </html>