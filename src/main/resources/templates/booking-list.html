<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Danh sách kho trống</title>
  <link rel="stylesheet" href="/css/storage-list.css">
  <style>
    .storage-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
    }
    @media (max-width: 1200px) {
      .storage-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
      .storage-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<a href="javascript:history.back()" class="btn-back-floating" title="Quay lại">
  <span style="font-size: 22px; vertical-align: middle;">&#8592;</span>
  <span style="margin-left: 4px; vertical-align: middle;">Quay lại</span>
</a>

<div class="page-wrapper">
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="navbar-content">
      <div class="navbar-brand">
        <a href="/homepage">
          <img src="https://res.cloudinary.com/dpkxslork/image/upload/v1750066568/logoooooooo_j1ynjc.png"
               alt="QVL Storage Logo" class="navbar-logo">
        </a>
      </div>
      <ul class="navbar-nav">
        <li><a href="/homepage">Trang chủ</a></li>
        <li><a href="/SWP/storages" class="active">Danh sách</a></li>
        <li><a href="/SWP/customers/my-bookings">Đơn hàng của tôi</a></li>
        <li><a href="/SWP/booking/search" class="active">Đặt kho</a></li>
      </ul>

    </div>
  </nav>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1>Kho trống phù hợp</h1>
      <p>Chọn kho phù hợp để tiến hành đặt thuê nhanh chóng và tiện lợi</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">

    <!-- Bộ lọc tìm kiếm -->
    <form th:action="@{/SWP/booking/search/result}" method="get" style="margin-bottom: 2rem;">
      <!-- 1. Luôn truyền hidden input cho startDate, endDate -->
      <input type="hidden" name="startDate" th:value="${startDate}" />
      <input type="hidden" name="endDate" th:value="${endDate}" />

      <div class="filter-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div>
          <label for="city" style="font-weight: bold;">Khu vực</label>
          <select id="city" name="city" class="form-input" th:value="${city}">
            <option value="">-- Tất cả --</option>
            <option th:each="cityItem : ${cities}"
                    th:value="${cityItem}"
                    th:text="${cityItem}"
                    th:selected="${cityItem == city}">
            </option>
          </select>
        </div>
        <div>
          <label for="nameKeyword" style="font-weight: bold;">Địa chỉ / Tên kho</label>
          <input type="text" id="nameKeyword" name="nameKeyword"
                 th:value="${nameKeyword}" placeholder="Nhập tên kho hoặc địa chỉ"
                 class="form-input" />
        </div>
        <div>
          <label for="minArea" style="font-weight: bold;">Diện tích tối thiểu (m²)</label>
          <input type="number" id="minArea" name="minArea"
                 th:value="${minArea}" placeholder="Ví dụ: 100"
                 min="0" class="form-input" />
        </div>
        <div>
          <label for="minPrice" style="font-weight: bold;">Giá từ (VNĐ/ngày)</label>
          <input type="number" id="minPrice" name="minPrice"
                 th:value="${minPrice}" placeholder="Ví dụ: 100000"
                 min="0" class="form-input" />
        </div>
        <div>
          <label for="maxPrice" style="font-weight: bold;">Giá đến (VNĐ/ngày)</label>
          <input type="number" id="maxPrice" name="maxPrice"
                 th:value="${maxPrice}" placeholder="Ví dụ: 500000"
                 min="0" class="form-input" />
        </div>
        <div>
          <label for="sortOption" style="font-weight: bold;">Sắp xếp</label>
          <select id="sortOption" name="sortOption" class="form-input" th:value="${sortOption}">
            <option value="">-- Mặc định --</option>
            <option value="priceAsc" th:selected="${sortOption == 'priceAsc'}">Giá tăng dần</option>
            <option value="priceDesc" th:selected="${sortOption == 'priceDesc'}">Giá giảm dần</option>
            <option value="areaAsc" th:selected="${sortOption == 'areaAsc'}">Diện tích tăng dần</option>
            <option value="areaDesc" th:selected="${sortOption == 'areaDesc'}">Diện tích giảm dần</option>
            <option value="nameAsc" th:selected="${sortOption == 'nameAsc'}">Tên A-Z</option>
            <option value="nameDesc" th:selected="${sortOption == 'nameDesc'}">Tên Z-A</option>
          </select>
        </div>
      </div>
      <div style="margin-top: 1rem;">
        <button type="submit" class="btn btn-primary">
          <i data-lucide="filter"></i> Lọc kết quả
        </button>
      </div>
    </form>


    <!-- No Result -->
    <div th:if="${#lists.isEmpty(storages)}" class="no-results">
      <div class="no-results-icon">
        <i data-lucide="search-x"></i>
      </div>
      <h3>Không có kho phù hợp trong khoảng thời gian này.</h3>
      <p>Vui lòng điều chỉnh lại khoảng thời gian để tìm kiếm kho trống khác.</p>
      <a th:href="@{/SWP/booking/search}" class="btn btn-primary" style="margin-top: 1rem;">
        <i data-lucide="search"></i> Tìm lại
      </a>
    </div>

    <!-- List of Available Storages -->
    <div th:if="${not #lists.isEmpty(storages)}" class="results-section">
      <div class="results-header">
        <div class="results-info">
          <h2>Tìm thấy <span class="count" th:text="${storages.size()}">0</span> kho</h2>
        </div>
      </div>

      <div class="storage-grid">
        <div class="storage-card" th:each="storage : ${storages}">
          <div class="card-header">
            <h3 class="storage-name" th:text="${storage.storagename}">Tên kho</h3>
            <div class="status-badge status-available">Còn trống</div>
          </div>

          <div class="card-content">
            <div class="storage-info">
              <div class="info-item">
                <i data-lucide="map-pin"></i>
                <span th:text="${storage.address}">Địa chỉ</span>
              </div>
              <div class="info-item">
                <i data-lucide="layout"></i>
                <span th:text="${storage.area} + ' m²'">0 m²</span>
              </div>
              <div class="info-item">
                <i data-lucide="tag"></i>
                <span th:text="${#numbers.formatDecimal(storage.pricePerDay, 0, 'COMMA', 0, 'POINT')} + ' VNĐ/ngày'">0 VNĐ/ngày</span>
              </div>
              <div class="info-item">
                <i data-lucide="globe"></i>
                <span th:text="${storage.city}">Thành phố</span>
              </div>
            </div>
          </div>

          <div class="card-footer">
            <a th:href="@{/SWP/booking/{storageId}/booking(storageId=${storage.storageid}, startDate=${startDate}, endDate=${endDate})}"
               class="btn btn-primary btn-full">
              <i data-lucide="calendar-plus"></i>
              Đặt kho
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <!-- ...footer như cũ... -->
  </footer>
</div>
<script>
  lucide.createIcons();
  function goToWishlist() {
    try {
      window.location.href = '/SWP/wishlist';
    } catch (error) {
      console.error('Error navigating to wishlist:', error);
    }
  }
</script>
</body>
</html>
