<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truy cập hồ sơ - QVL Storage</title>
    <link rel="stylesheet" th:href="@{/profile-access.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<!-- Sidebar -->
<nav class="sidebar">
    <div class="sidebar-header">
        <div class="logo">
            <i class="fas fa-database"></i>
            <span>QVL Storage</span>
        </div>
    </div>
    <ul class="sidebar-menu">
        <li class="menu-item">
            <a href="/SWP">
                <i class="fas fa-home"></i>
                <span>Trang chủ</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="/SWP/staff/staff-dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Bảng điều khiển</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="addstorage">
                <i class="fas fa-hdd"></i>
                <span>Thêm kho</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="/SWP/staff/staff-all-storage">
                <i class="fas fa-warehouse"></i>
                <span>Danh sách kho</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="/SWP/orders">
                <i class="fas fa-chart-bar"></i>
                <span>Đơn hàng</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="#inventory">
                <i class="fas fa-boxes"></i>
                <span>Phản hồi</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="#reports">
                <i class="fas fa-file-alt"></i>
                <span>Báo cáo</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="/SWP/customers">
                <i class="fas fa-users"></i>
                <span>Danh sách khách hàng</span>
            </a>
        </li>
        <li class="menu-item active">
            <a href="/SWP/support">
                <i class="fas fa-headset"></i>
                <span>Hỗ trợ khách hàng</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="#settings">
                <i class="fas fa-cog"></i>
                <span>Cài đặt</span>
            </a>
        </li>
    </ul>

    <div class="sidebar-footer">
        <div class="user-info">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-details">
                <span class="user-name">Nhân viên hỗ trợ</span>
                <span class="user-role">Chăm sóc khách hàng</span>
            </div>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="main-content">
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="sidebar-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <h1>Quản lý truy cập hồ sơ</h1>
        </div>

        <div class="header-right">
            <div class="breadcrumb">
                <a href="/SWP/support">Hỗ trợ khách hàng</a>
                <i class="fas fa-chevron-right"></i>
                <span>Truy cập hồ sơ</span>
            </div>
        </div>
    </header>

    <!-- Page Content -->
    <div class="page-content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-header-left">
                <div class="profile-avatar-large">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="profile-title">
                    <h2 class="page-title">Truy cập hồ sơ khách hàng</h2>
                    <p class="profile-subtitle">
                        <span>Truy cập và quản lý thông tin hồ sơ khách hàng an toàn, bảo mật</span>
                    </p>
                </div>
            </div>
            <div class="page-actions">
                <button class="btn-secondary btn-back">
                    <a href="/SWP/support" style="color: inherit; text-decoration: none;">
                        <i class="fas fa-arrow-left"></i>
                        Quay lại hỗ trợ
                    </a>
                </button>
                <button class="btn-secondary">
                    <i class="fas fa-shield-alt"></i>
                    Chính sách bảo mật
                </button>
            </div>
        </div>

        <!-- Access Form Card -->
        <div class="card form-card">
            <div class="card-header">
                <h3>
                    <i class="fas fa-user-check"></i>
                    Xác minh danh tính khách hàng
                </h3>
                <div class="privacy-badge">
                    <i class="fas fa-lock"></i>
                    <span>Bảo vệ quyền riêng tư</span>
                </div>
            </div>

            <div class="card-content">
                <!-- Error Message -->
                <div th:if="${error}" class="alert alert-error">
                    <div class="alert-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="alert-content">
                        <h4>Từ chối truy cập</h4>
                        <p th:text="${error}">Có lỗi xảy ra</p>
                    </div>
                </div>

                <!-- Success Message -->
                <div th:if="${success}" class="alert alert-success">
                    <div class="alert-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="alert-content">
                        <h4>Truy cập thành công</h4>
                        <p th:text="${success}">Thành công</p>
                    </div>
                </div>

                <form th:action="@{/SWP/support/profile-access}"
                      method="post"
                      class="access-form"
                      id="accessForm">

                    <!-- Instructions Section -->
                    <div class="instructions-section">
                        <div class="instruction-header">
                            <i class="fas fa-info-circle"></i>
                            <h4>Hướng dẫn truy cập</h4>
                        </div>
                        <div class="instruction-content">
                            <p>Để truy cập thông tin hồ sơ khách hàng, vui lòng xác minh danh tính khách hàng bằng các thông tin chính xác:</p>
                            <ul class="instruction-list">
                                <li><i class="fas fa-check"></i> Nhập họ và tên đầy đủ đúng theo giấy tờ tùy thân</li>
                                <li><i class="fas fa-check"></i> Cung cấp số CCCD/Hộ chiếu hợp lệ</li>
                                <li><i class="fas fa-check"></i> Đảm bảo thông tin trùng khớp với dữ liệu chính thức</li>
                                <li><i class="fas fa-check"></i> Tuân thủ quy định bảo vệ dữ liệu</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Form Fields -->
                    <div class="form-section">
                        <div class="section-header">
                            <h4>
                                <i class="fas fa-user-shield"></i>
                                Thông tin xác minh khách hàng
                            </h4>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fullname" class="form-label">
                                    <i class="fas fa-user"></i>
                                    Họ và tên đầy đủ *
                                </label>
                                <input type="text"
                                       id="fullname"
                                       name="fullname"
                                       required
                                       class="form-input"
                                       placeholder="Nhập đầy đủ họ và tên khách hàng"
                                       autocomplete="off">
                                <div class="form-help">
                                    <i class="fas fa-info-circle"></i>
                                    Phải trùng khớp với giấy tờ tùy thân
                                </div>
                                <div class="form-error" id="fullname-error"
                                     th:if="${errors != null and errors['fullname'] != null}"
                                     th:text="${errors['fullname']}"></div>
                            </div>

                            <div class="form-group">
                                <label for="id_citizen" class="form-label">
                                    <i class="fas fa-id-card"></i>
                                    Số CCCD/Hộ chiếu *
                                </label>
                                <input type="text"
                                       id="id_citizen"
                                       name="id_citizen"
                                       required
                                       class="form-input"
                                       placeholder="Nhập số CCCD/Hộ chiếu"
                                       autocomplete="off">
                                <div class="form-help">
                                    <i class="fas fa-info-circle"></i>
                                    Số định danh do nhà nước cấp
                                </div>
                                <div class="form-error"
                                     th:if="${errors != null and errors['id_citizen'] != null}"
                                     th:text="${errors['id_citizen']}"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Notice -->
                    <div class="privacy-notice">
                        <div class="notice-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="notice-content">
                            <h5>Bảo mật & Bảo vệ dữ liệu</h5>
                            <p>Mọi truy cập hồ sơ đều được ghi lại phục vụ an ninh. Dữ liệu khách hàng phải được bảo mật tuyệt đối theo quy định pháp luật và công ty. Mọi truy cập trái phép hoặc lạm dụng thông tin sẽ bị nghiêm cấm và xử lý nghiêm.</p>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="submitBtn">
                            <i class="fas fa-unlock-alt"></i>
                            Truy cập hồ sơ
                        </button>
                        <button type="button" class="btn-secondary" onclick="clearForm()">
                            <i class="fas fa-eraser"></i>
                            Xóa trắng
                        </button>
                        <a href="/SWP/support" class="btn-cancel">
                            <i class="fas fa-times"></i>
                            Hủy
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quick Access Tools -->
        <div class="card tools-card">
            <div class="card-header">
                <h3>
                    <i class="fas fa-tools"></i>
                    Công cụ truy cập nhanh
                </h3>
            </div>
            <div class="card-content">
                <div class="tools-grid">
                    <div class="tool-item">
                        <div class="tool-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="tool-content">
                            <h4>Tìm kiếm nâng cao</h4>
                            <p>Tìm khách hàng theo email, số điện thoại hoặc thông tin một phần</p>
                            <div class="tool-input">
                                <input type="text" placeholder="Tìm theo email hoặc số điện thoại..." class="search-input">
                                <button class="btn-primary tool-button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tool-item">
                        <div class="tool-icon">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <div class="tool-content">
                            <h4>Quét mã QR</h4>
                            <p>Quét mã QR để truy cập hồ sơ khách hàng nhanh chóng</p>
                            <button class="btn-secondary tool-button" onclick="openQRScanner()">
                                <i class="fas fa-camera"></i>
                                Quét mã QR
                            </button>
                        </div>
                    </div>

                    <div class="tool-item">
                        <div class="tool-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <div class="tool-content">
                            <h4>Lịch sử truy cập gần đây</h4>
                            <p>Xem lại các hồ sơ khách hàng vừa truy cập</p>
                            <button class="btn-secondary tool-button" onclick="showRecentAccesses()">
                                <i class="fas fa-clock"></i>
                                Xem lịch sử
                            </button>
                        </div>
                    </div>

                    <div class="tool-item">
                        <div class="tool-icon">
                            <i class="fas fa-file-export"></i>
                        </div>
                        <div class="tool-content">
                            <h4>Xuất dữ liệu hàng loạt</h4>
                            <p>Xuất dữ liệu khách hàng cho mục đích được phê duyệt</p>
                            <button class="btn-secondary tool-button" onclick="openBulkExport()">
                                <i class="fas fa-download"></i>
                                Xuất dữ liệu
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Access Guidelines -->
        <div class="card guidelines-card">
            <div class="card-header">
                <h3>
                    <i class="fas fa-shield-alt"></i>
                    Hướng dẫn truy cập dữ liệu
                </h3>
            </div>
            <div class="card-content">
                <div class="guidelines-grid">
                    <div class="guideline-item">
                        <div class="guideline-icon">
                            <i class="fas fa-user-lock"></i>
                        </div>
                        <div class="guideline-content">
                            <h5>Xác minh danh tính</h5>
                            <p>Luôn xác minh danh tính khách hàng bằng nhiều thông tin trước khi truy cập thông tin nhạy cảm.</p>
                        </div>
                    </div>
                    <div class="guideline-item">
                        <div class="guideline-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="guideline-content">
                            <h5>Chỉ truy cập khi được phép</h5>
                            <p>Chỉ truy cập dữ liệu khách hàng khi thực sự cần thiết cho nghiệp vụ, hỗ trợ khách hàng.</p>
                        </div>
                    </div>
                    <div class="guideline-item">
                        <div class="guideline-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="guideline-content">
                            <h5>Ghi lại lịch sử hoạt động</h5>
                            <p>Mọi hoạt động truy cập hồ sơ đều được ghi lại và kiểm soát theo quy định.</p>
                        </div>
                    </div>
                    <div class="guideline-item">
                        <div class="guideline-icon">
                            <i class="fas fa-user-secret"></i>
                        </div>
                        <div class="guideline-content">
                            <h5>Bảo mật thông tin</h5>
                            <p>Bảo mật tuyệt đối mọi thông tin khách hàng, tuân thủ quy trình bảo vệ dữ liệu.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Profile Access Activity -->
        <div class="card">
            <div class="card-header">
                <h3>
                    <i class="fas fa-clock"></i>
                    Lịch sử truy cập hồ sơ gần đây
                </h3>
                <div class="card-actions">
                    <button class="btn-secondary">
                        <i class="fas fa-refresh"></i>
                        Làm mới
                    </button>
                    <button class="btn-secondary">
                        <i class="fas fa-download"></i>
                        Xuất lịch sử
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>Thời gian</th>
                        <th>Khách hàng</th>
                        <th>Nhân viên</th>
                        <th>Loại truy cập</th>
                        <th>Trạng thái</th>
                        <th>Hành động</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>12:45 PM</td>
                        <td>
                            <div class="customer-info">
                                <div class="customer-avatar-small">
                                    <i class="fas fa-user"></i>
                                </div>
                                <span>John Doe</span>
                            </div>
                        </td>
                        <td>Nhân viên hỗ trợ</td>
                        <td>
                            <span class="access-badge profile">Xem hồ sơ</span>
                        </td>
                        <td>
                            <span class="status-badge success">Đã cho phép</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" title="Xem chi tiết">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon" title="Truy cập hồ sơ">
                                    <i class="fas fa-user"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>11:30 AM</td>
                        <td>
                            <div class="customer-info">
                                <div class="customer-avatar-small">
                                    <i class="fas fa-user"></i>
                                </div>
                                <span>Jane Smith</span>
                            </div>
                        </td>
                        <td>Nhân viên hỗ trợ</td>
                        <td>
                            <span class="access-badge edit">Chỉnh sửa hồ sơ</span>
                        </td>
                        <td>
                            <span class="status-badge success">Đã cho phép</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" title="Xem chi tiết">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon" title="Truy cập hồ sơ">
                                    <i class="fas fa-user"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>10:15 AM</td>
                        <td>
                            <div class="customer-info">
                                <div class="customer-avatar-small">
                                    <i class="fas fa-user"></i>
                                </div>
                                <span>Mike Johnson</span>
                            </div>
                        </td>
                        <td>Nhân viên hỗ trợ</td>
                        <td>
                            <span class="access-badge search">Tìm kiếm</span>
                        </td>
                        <td>
                            <span class="status-badge denied">Từ chối</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" title="Xem chi tiết">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon" title="Thử lại truy cập">
                                    <i class="fas fa-redo"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<script>
    // Sidebar toggle for mobile
    document.querySelector('.sidebar-toggle').addEventListener('click', function() {
        document.querySelector('.sidebar').classList.toggle('open');
    });

    // Form validation
    function validateForm() {
        let isValid = true;
        const requiredFields = ['fullname', 'id_citizen'];

        requiredFields.forEach(field => {
            const input = document.getElementById(field);
            const error = document.getElementById(field + '-error');

            if (!input.value.trim()) {
                error.textContent = 'Trường này là bắt buộc';
                input.classList.add('error');
                isValid = false;
            } else {
                error.textContent = '';
                input.classList.remove('error');
            }
        });

        return isValid;
    }

    // Clear form
    function clearForm() {
        if (confirm('Bạn có chắc chắn muốn xóa trắng tất cả thông tin vừa nhập không?')) {
            document.getElementById('accessForm').reset();
            document.querySelectorAll('.form-input').forEach(input => {
                input.classList.remove('error');
            });
            document.querySelectorAll('.form-error').forEach(error => {
                error.textContent = '';
            });
        }
    }

    // Tool functions
    function openQRScanner() {
        alert('Chức năng quét mã QR sẽ mở tại đây.');
    }

    function showRecentAccesses() {
        alert('Lịch sử truy cập gần đây sẽ hiển thị tại đây.');
    }

    function openBulkExport() {
        alert('Hộp thoại xuất dữ liệu hàng loạt sẽ mở tại đây.');
    }

    // Real-time validation
    document.querySelectorAll('.form-input').forEach(input => {
        input.addEventListener('blur', function() {
            const error = document.getElementById(this.id + '-error');
            if (this.hasAttribute('required') && !this.value.trim()) {
                error.textContent = 'Trường này là bắt buộc';
                this.classList.add('error');
            } else {
                error.textContent = '';
                this.classList.remove('error');
            }
        });

        // Remove error styling on input
        input.addEventListener('input', function() {
            if (this.classList.contains('error') && this.value.trim()) {
                this.classList.remove('error');
                const error = document.getElementById(this.id + '-error');
                error.textContent = '';
            }
        });
    });

    // Form submission
    document.getElementById('accessForm').addEventListener('submit', function(e) {
        if (!validateForm()) {
            e.preventDefault();
        } else {
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang xác minh...';
            submitBtn.disabled = true;
        }
    });

    // Advanced search functionality
    document.querySelector('.search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const searchTerm = this.value;
            if (searchTerm) {
                alert(`Đang tìm kiếm: ${searchTerm}`);
            }
        }
    });

    // Auto-hide alerts after 5 seconds
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 300);
        });
    }, 5000);
</script>
</body>
</html>
