<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi tiết đơn hàng - QVL STORAGE</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800 font-sans">
<header class="bg-green-600 text-white p-4 shadow">
    <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-xl font-bold">Chi tiết đơn hàng</h1>
        <nav class="space-x-6">
            <a href="/SWP/home" class="hover:underline">Trang chủ</a>
            <a href="/SWP/customers/my-bookings" class="hover:underline">Đơn hàng của tôi</a>
        </nav>
    </div>
</header>

<main class="container mx-auto px-4 py-8">
    <div class="bg-white rounded-xl shadow-lg p-6 max-w-3xl mx-auto">
        <h2 class="text-2xl font-bold mb-6 text-green-700">Thông tin đơn hàng</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-base">
            <p><span class="font-semibold">Mã đơn hàng:</span> <span th:text="'#' + ${order.id}"></span></p>
            <p><span class="font-semibold">Tên kho:</span> <span th:text="${order.storage.storagename}"></span></p>
            <p><span class="font-semibold">Địa chỉ kho:</span> <span th:text="${order.storage.address}"></span></p>
            <p><span class="font-semibold">Diện tích:</span> <span th:text="${order.storage.area} + ' m²'"></span></p>
            <p><span class="font-semibold">Ngày bắt đầu:</span> <span th:text="${#temporals.format(order.startDate, 'dd/MM/yyyy')}"></span></p>
            <p><span class="font-semibold">Ngày kết thúc:</span> <span th:text="${#temporals.format(order.endDate, 'dd/MM/yyyy')}"></span></p>
            <p><span class="font-semibold">Tổng tiền:</span> <span th:text="${#numbers.formatInteger(order.totalAmount, '0')}"></span> VNĐ</p>
            <p>
                <span class="font-semibold">Trạng thái:</span>
                <span th:if="${order.status == 'CANCELLED'}" class="text-red-600 font-bold" th:text="${order.status}"></span>
                <span th:if="${order.status == 'CONFIRMED'}" class="text-green-600 font-bold" th:text="${order.status}"></span>
                <span th:unless="${order.status == 'CANCELLED' || order.status == 'CONFIRMED'}" class="text-yellow-600 font-bold" th:text="${order.status}"></span>
            </p>
        </div>

        <div th:if="${order.status == 'CANCELLED'}" class="mt-4 text-sm italic text-gray-600">
            <span class="font-semibold">Lý do hủy:</span> <span th:text="${order.cancelReason}"></span>
        </div>

        <div class="mt-6 text-right">
            <button th:if="${order.status == 'PENDING' || order.status == 'CONFIRMED'}"
                    onclick="openCancelModal()"
                    class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-md font-semibold">
                Hủy đơn
            </button>
        </div>
    </div>
</main>

<!-- Modal -->
<div id="cancelModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-lg">
        <h3 class="text-xl font-bold mb-4 text-green-800">Lý do hủy đơn hàng</h3>
        <form th:action="@{/SWP/customers/my-bookings/{id}/cancel(id=${order.id})}" method="post" onsubmit="return validateCancelReason()">
            <div class="space-y-3 text-sm text-gray-700">
                <label><input type="radio" name="cancelReason" value="Không còn nhu cầu thuê kho" required> Tôi không còn nhu cầu thuê kho</label>
                <label><input type="radio" name="cancelReason" value="Muốn thay đổi thời gian thuê"> Muốn thay đổi thời gian thuê</label>
                <label><input type="radio" name="cancelReason" value="Đã tìm được kho khác phù hợp hơn"> Đã tìm được kho khác</label>
                <label><input type="radio" name="cancelReason" value="Giá thuê chưa phù hợp"> Giá thuê chưa phù hợp</label>
                <label><input type="radio" name="cancelReason" value="Nhập sai thông tin khi đặt"> Nhập sai thông tin</label>
                <label><input type="radio" name="cancelReason" value="other" id="reason-other-radio"> Khác:
                    <input type="text" name="otherReason" id="otherReasonInput"
                           class="border border-gray-300 rounded px-2 py-1 ml-2 w-1/2"
                           placeholder="Nhập lý do khác" disabled>
                </label>
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button type="button" onclick="closeCancelModal()" class="px-4 py-2 rounded bg-gray-100 hover:bg-gray-200">Hủy</button>
                <button type="submit" class="px-5 py-2 bg-red-600 text-white rounded hover:bg-red-700">Xác nhận</button>
            </div>
        </form>
    </div>
</div>

<footer class="bg-green-700 text-white text-center py-3 mt-10">
    © 2025 QVL STORAGE. All rights reserved.
</footer>

<script>
    function openCancelModal() {
        document.getElementById('cancelModal').classList.remove('hidden');
        document.getElementById('cancelModal').classList.add('flex');
    }
    function closeCancelModal() {
        document.getElementById('cancelModal').classList.remove('flex');
        document.getElementById('cancelModal').classList.add('hidden');
    }
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('input[name="cancelReason"]').forEach(radio => {
            radio.addEventListener('change', function () {
                const otherInput = document.getElementById('otherReasonInput');
                if (this.value === "other") {
                    otherInput.disabled = false;
                    otherInput.focus();
                } else {
                    otherInput.disabled = true;
                    otherInput.value = '';
                }
            });
        });
    });
    function validateCancelReason() {
        const otherRadio = document.getElementById('reason-other-radio');
        const otherInput = document.getElementById('otherReasonInput');
        if (otherRadio.checked && !otherInput.value.trim()) {
            alert("Vui lòng nhập lý do khác.");
            otherInput.focus();
            return false;
        }
        return true;
    }
</script>
</body>
</html>
