<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .transaction-table { margin-top: 20px; }
        .form-container { margin-bottom: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-4">Transaction Management</h1>

    <!-- Form to add a new transaction -->
    <div class="form-container">
        <h3>Add New Transaction</h3>
        <div class="mb-3">
            <label for="type" class="form-label">Type (IMPORT/EXPORT):</label>
            <input type="text" class="form-control" id="type" placeholder="Enter type">
        </div>
        <div class="mb-3">
            <label for="transactionDate" class="form-label">Transaction Date (YYYY-MM-DD):</label>
            <input type="date" class="form-control" id="transactionDate">
        </div>
        <div class="mb-3">
            <label for="storageId" class="form-label">Storage ID:</label>
            <input type="number" class="form-control" id="storageId" placeholder="Enter storage ID">
        </div>
        <div class="mb-3">
            <label for="customerId" class="form-label">Customer ID:</label>
            <input type="number" class="form-control" id="customerId" placeholder="Enter customer ID">
        </div>
        <button class="btn btn-primary" onclick="addTransaction()">Add Transaction</button>
    </div>

    <!-- Table to display transactions -->
    <h3>Transaction List</h3>
    <table class="table table-striped transaction-table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Transaction Date</th>
            <th>Storage ID</th>
            <th>Customer ID</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="transactionTableBody">
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    // Fetch and display all transactions on page load
    document.addEventListener("DOMContentLoaded", () => {
        fetchTransactions();
    });

    // Fetch all transactions
    async function fetchTransactions() {
        try {
            const response = await axios.get("/api/transaction/all-transactions");
            const transactions = response.data;
            const tableBody = document.getElementById("transactionTableBody");
            tableBody.innerHTML = ""; // Clear existing rows
            transactions.forEach(transaction => {
                const row = document.createElement("tr");
                row.innerHTML = `
                        <td>${transaction.id}</td>
                        <td>${transaction.type}</td>
                        <td>${transaction.transactionDate}</td>
                        <td>${transaction.storage?.storageid || "N/A"}</td>
                        <td>${transaction.customer?.id || "N/A"}</td>
                        <td>
                            <button class="btn btn-info btn-sm" onclick="viewTransaction(${transaction.id})">View</button>
                        </td>
                    `;
                tableBody.appendChild(row);
            });
        } catch (error) {
            console.error("Error fetching transactions:", error);
            alert("Failed to load transactions.");
        }
    }

    // View a single transaction by ID
    async function viewTransaction(id) {
        try {
            const response = await axios.get(`/api/transaction/findByID/${id}`);
            const transaction = response.data;
            alert(`Transaction Details:\nID: ${transaction.id}\nType: ${transaction.type}\nDate: ${transaction.transactionDate}\nStorage ID: ${transaction.storage?.storageid || "N/A"}\nCustomer ID: ${transaction.customer?.id || "N/A"}`);
        } catch (error) {
            console.error("Error fetching transaction:", error);
            alert("Failed to load transaction details.");
        }
    }

    // Add a new transaction
    async function addTransaction() {
        const type = document.getElementById("type").value;
        const transactionDate = document.getElementById("transactionDate").value;
        const storageId = document.getElementById("storageId").value;
        const customerId = document.getElementById("customerId").value;

        if (!type || !transactionDate || !storageId || !customerId) {
            alert("Please fill in all fields.");
            return;
        }

        const transaction = {
            type: type,
            transactionDate: transactionDate,
            storage: { storageid: parseInt(storageId) },
            customer: { id: parseInt(customerId) }
        };

        try {
            await axios.post("/api/transaction/save", transaction);
            alert("Transaction added successfully!");
            fetchTransactions(); // Refresh the table
            // Clear the form
            document.getElementById("type").value = "";
            document.getElementById("transactionDate").value = "";
            document.getElementById("storageId").value = "";
            document.getElementById("customerId").value = "";
        } catch (error) {
            console.error("Error adding transaction:", error);
            alert("Failed to add transaction.");
        }
    }
</script>
</body>
</html>